import"./DsnmJJEf.js";import{h as T,a as ie,m as oe,b as ce,au as K,a3 as le,a4 as fe,a5 as de,a6 as U,a7 as W,av as R,aw as Y,M as Z,d as q,ax as ue,f as he,ay as J,az as Q,aA as V,W as me,a8 as X,p as z,aB as ve,aC as L,K as n,L as I,aD as pe,ag as _e,q as se,B as _,C as c,aE as A,x as l,y as ae,aF as ge,v as ke,D as xe,a9 as $}from"./Bg6t5N8x.js";import{i as D,c as ee}from"./g4b5VIZf.js";import{e as ye}from"./-IAPk5y9.js";import{c as te}from"./hTM7ewlf.js";const j=0,N=1,F=2;function Ee(f,e,t,a,d){T&&ie();var r=f,b=oe(),u=me,s=W,h,x,E,w=b?Y(void 0):Z(void 0,!1,!1),S=b?Y(void 0):Z(void 0,!1,!1),B=!1;function m(i,o){B=!0,o&&(J(g),Q(g),V(u));try{i===j&&t&&(h?X(h):h=q(()=>t(r))),i===N&&a&&(x?X(x):x=q(()=>a(r,w))),i!==j&&h&&z(h,()=>h=null),i!==N&&x&&z(x,()=>x=null),i!==F&&E&&z(E,()=>E=null)}finally{o&&(V(null),Q(null),J(null),ve())}}var g=ce(()=>{if(s===(s=e()))return;let i=T&&K(s)===(r.data===le);if(i&&(r=fe(),de(r),U(!1),i=!0),K(s)){var o=s;B=!1,o.then(v=>{o===s&&(R(w,v),m(N,!0))},v=>{if(o===s)throw R(S,v),m(F,!0),S.v}),T?t&&(h=q(()=>t(r))):ue(()=>{B||m(j,!0)})}else R(w,s),m(N,!1);return i&&U(!0),()=>s=W});T&&(r=he)}class G extends EventTarget{static _idCounter=0;_props;result=Ce();id;component;modals;#e=L(!1);get exitBeforeEnter(){return n(this.#e)}set exitBeforeEnter(e){I(this.#e,e,!0)}constructor(e,{id:t,component:a,props:d}){super(),this.id=t||(G._idCounter++).toString(),this.component=a,this._props=d??{},this.modals=e}#t=pe(()=>this.modals.stack.length===0?!1:this.modals.stack[this.modals.stack.length-1].id===this.id&&!this.modals.transitioning);get isOpen(){return n(this.#t)}set isOpen(e){I(this.#t,e)}get index(){return this.modals.stack.indexOf(this)}get props(){return{...this._props,id:this.id,index:this.index,isOpen:this.isOpen,close:this.close}}close=(...e)=>{if(this.onBeforeClose?.()===!1)return!1;const t=e[0];return this.dispatchEvent(new CustomEvent("close",{detail:t})),this.result.resolve(t),!0};get promise(){return this.result.promise}onBeforeClose}function Ce(){let f,e;return{promise:new Promise((a,d)=>{f=a,e=d}),resolve:f,reject:e}}class be{#e=L(_e([]));get stack(){return n(this.#e)}set stack(e){I(this.#e,e,!0)}#t=L(null);get action(){return n(this.#t)}set action(e){I(this.#t,e,!0)}#s=L(!1);get transitioning(){return n(this.#s)}set transitioning(e){I(this.#s,e,!0)}open=async(e,t,a)=>{if(this.transitioning)return;if(a?.replace&&!this.stack[this.stack.length-1]?.close())throw new Error("Current modal prevented closing");this.action="push",this.stack[this.stack.length-1]?.exitBeforeEnter&&(this.transitioning=!0);const r=new G(this,{id:a?.id,component:e,props:t});return this.stack.push(r),r.addEventListener("close",()=>{r.exitBeforeEnter&&(this.transitioning=!0),this.stack.indexOf(r)>-1&&this.stack.splice(this.stack.indexOf(r),1),this.action="pop"},{once:!0}),r.promise};close=(e=1)=>{if(typeof e!="number"||e<1)throw new Error(`amount must be a number greater than 0. Received ${e}`);const t=this.stack.slice(this.stack.length-e).reverse();let a=0;for(const d of t){if(!d.close())break;a++}return e===a};closeById=e=>{const t=this.stack.find(a=>a.id===e);return t?t.close():!1};closeAll=()=>this.close(this.stack.length)}const we=Symbol("modal");function Be(f){ge(we,f)}function Me(f,e){se(e,!0),Be(e.modal);var t=_(),a=c(t);A(a,()=>e.children),l(f,t),ae()}const C=new be;var Oe=ke("<!> <!>",1);function Ne(f,e){se(e,!0);function t(u){return typeof u.prototype>"u"}var a=Oe(),d=c(a);{var r=u=>{var s=_(),h=c(s);A(h,()=>e.backdrop??$,()=>C),l(u,s)};D(d,u=>{C.stack.length>0&&u(r)})}var b=xe(d,2);ye(b,19,()=>C.stack,u=>u.id,(u,s)=>{Me(u,{get modal(){return n(s)},children:(h,x)=>{var E=_(),w=c(E);{var S=m=>{var g=_(),i=c(g);Ee(i,()=>n(s).component(),o=>{var v=_(),p=c(v);A(p,()=>e.loading??$,()=>C),l(o,v)},(o,v)=>{var p=_(),y=c(p);{var M=k=>{var O=_(),H=c(O);A(H,()=>e.modal,()=>({component:n(v).default,props:n(s).props}),()=>C),l(k,O)},P=k=>{var O=_(),H=c(O);te(H,()=>n(v).default,(re,ne)=>{ne(re,ee(()=>n(s).props))}),l(k,O)};D(y,k=>{e.modal?k(M):k(P,!1)})}l(o,p)}),l(m,g)},B=m=>{var g=_(),i=c(g);{var o=p=>{var y=_(),M=c(y);A(M,()=>e.modal,()=>({component:n(s).component,props:n(s).props}),()=>C),l(p,y)},v=p=>{var y=_(),M=c(y);te(M,()=>n(s).component,(P,k)=>{k(P,ee(()=>n(s).props))}),l(p,y)};D(i,p=>{e.modal?p(o):p(v,!1)})}l(m,g)};D(w,m=>{t(n(s).component)?m(S):m(B,!1)})}l(h,E)},$$slots:{default:!0}})}),l(f,a),ae()}export{Ne as M,C as m};
